{"version":3,"file":"pricelistExportService-CZyW_cRP.js","sources":["../../src/services/pricelistExportService.ts"],"sourcesContent":["import * as XLSX from 'xlsx';\r\nimport { productService } from './productService';\r\nimport type { Product } from '../types/domain';\r\n\r\n/**\r\n * Service to integrate Splitfin updates with the existing Pricelists export system\r\n * This bridges the gap between Splitfin's real-time updates and the batch export processes\r\n *\r\n * NOTE: Converted from Supabase to use productService (backend API pattern)\r\n * The old 'items' table with 'brands' relation is now the 'products' table with a 'brand' string field\r\n */\r\n\r\ninterface ExportItem {\r\n  id?: number;\r\n  sku: string;\r\n  name: string;\r\n  description?: string;\r\n  brand?: string;\r\n  category?: string;\r\n  colour?: string;\r\n  ean?: string;\r\n  manufacturer?: string;\r\n  packing_unit?: number;\r\n  cost_price?: number;\r\n  retail_price?: number;\r\n  purchase_price?: number;\r\n  rate?: number;\r\n  weight?: number;\r\n  height?: number;\r\n  width?: number;\r\n  length?: number;\r\n  diameter?: number;\r\n  volume?: number;\r\n  gross_stock_level?: number;\r\n  stock_on_hand?: number;\r\n  reorder_level?: number;\r\n  catalogue_page_number?: string;\r\n  burning_hours?: string;\r\n  scent?: string;\r\n  dishwasher?: string;\r\n  microwave?: string;\r\n  image_url?: string;\r\n  image_urls?: string[];\r\n  status?: string;\r\n  created_date?: string;\r\n  created_at?: string;\r\n  updated_at?: string;\r\n}\r\n\r\nclass PricelistExportService {\r\n  private pricelistsBasePath = '/Users/alastairblair/Development/Pricelists';\r\n\r\n  /**\r\n   * Export updated inventory data to formats compatible with existing Pricelists system\r\n   */\r\n  public exportToMasterDatasets = async (): Promise<void> => {\r\n    try {\r\n      console.log('Starting master dataset export...');\r\n\r\n      // Get all active inventory items from backend API via productService\r\n      const response = await productService.list({ status: 'active' });\r\n      const items = response.data as ExportItem[];\r\n\r\n      if (!items || items.length === 0) {\r\n        console.log('No active items found for export');\r\n        return;\r\n      }\r\n\r\n      // Group items by brand for export\r\n      const itemsByBrand = this.groupItemsByBrand(items);\r\n\r\n      // Export each brand to separate master files (compatible with existing system)\r\n      await Promise.all(Object.entries(itemsByBrand).map(([brandName, brandItems]) =>\r\n        this.exportBrandMasterFile(brandName, brandItems)\r\n      ));\r\n\r\n      // Create consolidated master file\r\n      await this.createConsolidatedMaster(items);\r\n\r\n      console.log('Master dataset export completed');\r\n    } catch (error) {\r\n      console.error('Error in exportToMasterDatasets:', error);\r\n      throw error;\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Group items by brand name for export\r\n   */\r\n  private groupItemsByBrand = (items: ExportItem[]): { [brandName: string]: ExportItem[] } => {\r\n    return items.reduce((acc, item) => {\r\n      // In the new schema, brand is a direct string field on products\r\n      const brandName = item.brand || 'Unknown';\r\n      if (!acc[brandName]) {\r\n        acc[brandName] = [];\r\n      }\r\n      acc[brandName].push(item);\r\n      return acc;\r\n    }, {} as { [brandName: string]: ExportItem[] });\r\n  };\r\n\r\n  /**\r\n   * Export individual brand master file (compatible with existing Pricelists system)\r\n   */\r\n  private exportBrandMasterFile = async (brandName: string, items: ExportItem[]): Promise<void> => {\r\n    try {\r\n      // Map Splitfin data to Pricelists system format\r\n      const exportData = items.map(item => ({\r\n        // Core product info\r\n        sku: item.sku || '',\r\n        name: item.name || '',\r\n        description: item.description || item.name || '',\r\n        brand_name: brandName,\r\n        category: item.category || '',\r\n        colour: item.colour || '',\r\n        ean: item.ean || '',\r\n        manufacturer: item.manufacturer || brandName,\r\n\r\n        // Pricing (use rate as fallback for retail_price in new schema)\r\n        cost_price: item.cost_price || 0,\r\n        retail_price: item.retail_price || item.rate || 0,\r\n        purchase_price: item.purchase_price || item.cost_price || 0,\r\n\r\n        // Physical attributes\r\n        weight: item.weight || 0,\r\n        height: item.height || 0,\r\n        width: item.width || 0,\r\n        length: item.length || 0,\r\n        diameter: item.diameter || 0,\r\n        volume: item.volume || 0,\r\n\r\n        // Inventory (use stock_on_hand from new schema)\r\n        packing_unit: item.packing_unit || 1,\r\n        gross_stock_level: item.gross_stock_level || item.stock_on_hand || 0,\r\n        reorder_level: item.reorder_level || 0,\r\n\r\n        // Additional\r\n        catalogue_page_number: item.catalogue_page_number || '',\r\n        burning_hours: item.burning_hours || '',\r\n        scent: item.scent || '',\r\n        dishwasher: item.dishwasher || '',\r\n        microwave: item.microwave || '',\r\n\r\n        // Metadata\r\n        status: item.status || 'active',\r\n        created_date: item.created_date || item.created_at,\r\n        updated_at: item.updated_at || new Date().toISOString()\r\n      }));\r\n\r\n      // Create Excel file for compatibility\r\n      const worksheet = XLSX.utils.json_to_sheet(exportData);\r\n      const workbook = XLSX.utils.book_new();\r\n      XLSX.utils.book_append_sheet(workbook, worksheet, brandName);\r\n\r\n      // Export path compatible with existing system\r\n      const filename = `Master - ${brandName.replace(/[^a-zA-Z0-9]/g, '')}.xlsx`;\r\n\r\n      // Generate and download the Excel file\r\n      const buffer = XLSX.write(workbook, { bookType: 'xlsx', type: 'array' });\r\n      const blob = new Blob([buffer], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });\r\n\r\n      // Auto-download the file\r\n      const url = window.URL.createObjectURL(blob);\r\n      const link = document.createElement('a');\r\n      link.href = url;\r\n      link.download = filename;\r\n      link.click();\r\n      window.URL.revokeObjectURL(url);\r\n\r\n      console.log(`Exported ${items.length} items for ${brandName} to ${filename}`);\r\n\r\n      // Store export data for tracking\r\n      await this.storeExportData(brandName, exportData, 'brand_master');\r\n\r\n    } catch (error) {\r\n      console.error(`Error exporting brand file for ${brandName}:`, error);\r\n      throw error;\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Create consolidated master file (compatible with existing system)\r\n   */\r\n  private createConsolidatedMaster = async (items: ExportItem[]): Promise<void> => {\r\n    try {\r\n      // Map all items to consolidated format\r\n      const consolidatedData = items.map(item => ({\r\n        id: item.id || '',\r\n        sku: item.sku || '',\r\n        name: item.name || '',\r\n        description: item.description || item.name || '',\r\n        brand_name: item.brand || 'Unknown',\r\n        category: item.category || '',\r\n        colour: item.colour || '',\r\n        ean: item.ean || '',\r\n        manufacturer: item.manufacturer || item.brand || 'Unknown',\r\n        packing_unit: item.packing_unit || 1,\r\n        cost_price: item.cost_price || 0,\r\n        retail_price: item.retail_price || item.rate || 0,\r\n        purchase_price: item.purchase_price || item.cost_price || 0,\r\n        weight: item.weight || 0,\r\n        height: item.height || 0,\r\n        width: item.width || 0,\r\n        length: item.length || 0,\r\n        volume: item.volume || 0,\r\n        catalogue_page_number: item.catalogue_page_number || '',\r\n        burning_hours: item.burning_hours || '',\r\n        scent: item.scent || '',\r\n        dishwasher: item.dishwasher || '',\r\n        microwave: item.microwave || '',\r\n        image_url: item.image_url || (item.image_urls && item.image_urls[0]) || '',\r\n        status: item.status || 'active',\r\n        created_date: item.created_date || item.created_at,\r\n        updated_at: item.updated_at || new Date().toISOString()\r\n      }));\r\n\r\n      console.log(`Creating consolidated master with ${consolidatedData.length} total items`);\r\n\r\n      // Create Excel workbook for consolidated data\r\n      const worksheet = XLSX.utils.json_to_sheet(consolidatedData);\r\n      const workbook = XLSX.utils.book_new();\r\n      XLSX.utils.book_append_sheet(workbook, worksheet, 'All Products');\r\n\r\n      // Generate and download the consolidated Excel file\r\n      const filename = 'Master - Consolidated.xlsx';\r\n      const buffer = XLSX.write(workbook, { bookType: 'xlsx', type: 'array' });\r\n      const blob = new Blob([buffer], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });\r\n\r\n      // Auto-download the file\r\n      const url = window.URL.createObjectURL(blob);\r\n      const link = document.createElement('a');\r\n      link.href = url;\r\n      link.download = filename;\r\n      link.click();\r\n      window.URL.revokeObjectURL(url);\r\n\r\n      console.log(`Exported consolidated master with ${consolidatedData.length} items`);\r\n\r\n      // Store consolidated data\r\n      await this.storeExportData('Consolidated', consolidatedData, 'master_consolidated');\r\n\r\n    } catch (error) {\r\n      console.error('Error creating consolidated master:', error);\r\n      throw error;\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Generate export files for external systems (Zoho, etc.)\r\n   * NOTE: Shopify export removed as per project requirements - this is a standalone platform\r\n   */\r\n  public generateSystemExports = async (): Promise<{ [system: string]: unknown[] }> => {\r\n    try {\r\n      console.log('Generating system exports...');\r\n\r\n      // Get consolidated data via productService\r\n      const response = await productService.list({ status: 'active' });\r\n      const items = response.data as ExportItem[];\r\n\r\n      if (!items) {\r\n        throw new Error('Failed to fetch items for export');\r\n      }\r\n\r\n      const exports = {\r\n        zoho: this.formatForZoho(items),\r\n        neon: this.formatForNeonProducts(items),\r\n        bluealligator: this.formatForBlueAlligator(items)\r\n      };\r\n\r\n      // Store each export\r\n      await Promise.all(Object.entries(exports).map(([system, data]) =>\r\n        this.storeExportData(system, data, `export_${system}`)\r\n      ));\r\n\r\n      console.log('System exports completed');\r\n      return exports;\r\n\r\n    } catch (error) {\r\n      console.error('Error generating system exports:', error);\r\n      throw error;\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Format data for Zoho Inventory import\r\n   */\r\n  private formatForZoho = (items: ExportItem[]): Record<string, unknown>[] => {\r\n    return items.map(item => ({\r\n      'Item Name': item.name || '',\r\n      'SKU': item.sku || '',\r\n      'Description': item.description || '',\r\n      'Category': item.category || '',\r\n      'Brand': item.brand || '',\r\n      'Manufacturer': item.manufacturer || item.brand || '',\r\n      'UPC': item.ean || '',\r\n      'EAN': item.ean || '',\r\n      'ISBN': '',\r\n      'Part Number': item.sku || '',\r\n      'Item Type': 'inventory',\r\n      'Product Type': 'goods',\r\n      'Stock on hand': item.gross_stock_level || item.stock_on_hand || 0,\r\n      'Opening Stock Rate': item.cost_price || 0,\r\n      'Reorder Level': item.reorder_level || 0,\r\n      'Preferred Vendor': item.brand || '',\r\n      'Purchase Rate': item.purchase_price || item.cost_price || 0,\r\n      'Purchase Account': 'Cost of Goods Sold',\r\n      'Purchase Description': item.description || '',\r\n      'Sales Rate': item.retail_price || item.rate || 0,\r\n      'Sales Account': 'Sales',\r\n      'Sales Description': item.description || '',\r\n      'Tax Preference': 'taxable',\r\n      'Exemption Reason': '',\r\n      'Purchase Tax': '',\r\n      'Sales Tax': '',\r\n      'Item Status': item.status === 'active' ? 'active' : 'inactive',\r\n      'Source': 'user',\r\n      'Is Returnable Item': 'true',\r\n      'Weight': item.weight || 0,\r\n      'Weight Unit': 'kg',\r\n      'Dimensions (Length x Width x Height)': `${item.length || 0} x ${item.width || 0} x ${item.height || 0}`,\r\n      'Dimension Unit': 'cm',\r\n      'Created Time': item.created_date || item.created_at,\r\n      'Last Modified Time': item.updated_at\r\n    }));\r\n  };\r\n\r\n  /**\r\n   * Format data for Neon products table (replaces formatForSupabaseItems)\r\n   */\r\n  private formatForNeonProducts = (items: ExportItem[]): Record<string, unknown>[] => {\r\n    return items.map(item => ({\r\n      id: item.id,\r\n      sku: item.sku,\r\n      name: item.name,\r\n      description: item.description,\r\n      brand: item.brand,\r\n      category: item.category,\r\n      colour: item.colour,\r\n      ean: item.ean,\r\n      manufacturer: item.manufacturer,\r\n      packing_unit: item.packing_unit,\r\n      cost_price: item.cost_price,\r\n      retail_price: item.retail_price || item.rate,\r\n      purchase_price: item.purchase_price,\r\n      rate: item.rate,\r\n      weight: item.weight,\r\n      height: item.height,\r\n      width: item.width,\r\n      length: item.length,\r\n      volume: item.volume,\r\n      stock_on_hand: item.stock_on_hand || item.gross_stock_level,\r\n      reorder_level: item.reorder_level,\r\n      catalogue_page_number: item.catalogue_page_number,\r\n      burning_hours: item.burning_hours,\r\n      scent: item.scent,\r\n      dishwasher: item.dishwasher,\r\n      microwave: item.microwave,\r\n      image_urls: item.image_urls,\r\n      status: item.status,\r\n      created_at: item.created_at || item.created_date,\r\n      updated_at: item.updated_at\r\n    }));\r\n  };\r\n\r\n  /**\r\n   * Format data for BlueAlligator system\r\n   */\r\n  private formatForBlueAlligator = (items: ExportItem[]): Record<string, unknown>[] => {\r\n    return items.map(item => ({\r\n      'Product Code': item.sku || '',\r\n      'Product Name': item.name || '',\r\n      'Description': item.description || '',\r\n      'Brand': item.brand || '',\r\n      'Category': item.category || '',\r\n      'Colour': item.colour || '',\r\n      'Barcode': item.ean || '',\r\n      'Supplier': item.manufacturer || item.brand || '',\r\n      'Pack Size': item.packing_unit || 1,\r\n      'Cost Price': item.cost_price || 0,\r\n      'Retail Price': item.retail_price || item.rate || 0,\r\n      'Weight (kg)': item.weight || 0,\r\n      'Dimensions (cm)': `${item.length || 0}x${item.width || 0}x${item.height || 0}`,\r\n      'Stock Level': item.gross_stock_level || item.stock_on_hand || 0,\r\n      'Reorder Level': item.reorder_level || 0,\r\n      'Status': item.status || 'active',\r\n      'Date Added': item.created_date || item.created_at,\r\n      'Last Updated': item.updated_at\r\n    }));\r\n  };\r\n\r\n  /**\r\n   * Store export data in localStorage for tracking\r\n   * TODO: Could be extended to call a backend API endpoint for export logging\r\n   */\r\n  private storeExportData = async (system: string, data: unknown[], type: string): Promise<void> => {\r\n    try {\r\n      const exportRecord = {\r\n        system,\r\n        type,\r\n        record_count: data.length,\r\n        generated_at: new Date().toISOString(),\r\n        status: 'ready'\r\n      };\r\n\r\n      console.log(`Export stored for ${system}:`, exportRecord);\r\n\r\n      // Store in localStorage for tracking (replaces Supabase export_logs table)\r\n      const exportLogs = JSON.parse(localStorage.getItem('export_logs') || '[]');\r\n      exportLogs.push(exportRecord);\r\n      // Keep only last 100 export logs\r\n      if (exportLogs.length > 100) {\r\n        exportLogs.splice(0, exportLogs.length - 100);\r\n      }\r\n      localStorage.setItem('export_logs', JSON.stringify(exportLogs));\r\n\r\n    } catch (error) {\r\n      console.error(`Error storing export data for ${system}:`, error);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Trigger the existing auto_process.py script (if needed)\r\n   */\r\n  public triggerLegacyExports = async (): Promise<void> => {\r\n    try {\r\n      console.log('Triggering legacy export processes...');\r\n\r\n      // In a real implementation, you could:\r\n      // 1. Call Python script via child process (server-side only)\r\n      // 2. Queue a background job via backend API\r\n      // 3. Send webhook to trigger external process\r\n\r\n      // For now, just log what would happen\r\n      console.log('Would execute: python3 /Users/alastairblair/Development/Pricelists/auto_process.py');\r\n\r\n    } catch (error) {\r\n      console.error('Error triggering legacy exports:', error);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Full export workflow - combines all export processes\r\n   */\r\n  public runFullExportWorkflow = async (): Promise<void> => {\r\n    try {\r\n      console.log('Starting full export workflow...');\r\n\r\n      // Step 1: Export to master datasets (compatible with existing system)\r\n      await this.exportToMasterDatasets();\r\n\r\n      // Step 2: Generate system exports\r\n      await this.generateSystemExports();\r\n\r\n      // Step 3: Trigger legacy processes if needed\r\n      await this.triggerLegacyExports();\r\n\r\n      console.log('Full export workflow completed successfully');\r\n\r\n    } catch (error) {\r\n      console.error('Error in full export workflow:', error);\r\n      throw error;\r\n    }\r\n  };\r\n}\r\n\r\nexport const pricelistExportService = new PricelistExportService();\r\n"],"names":["PricelistExportService","items","productService","itemsByBrand","brandName","brandItems","error","acc","item","exportData","worksheet","XLSX.utils","workbook","filename","buffer","XLSX.write","blob","url","link","consolidatedData","exports","system","data","type","exportRecord","exportLogs","pricelistExportService"],"mappings":"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"}