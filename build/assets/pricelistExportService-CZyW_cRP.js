import{p as h,u as l,w as i}from"./index-a7voj5dR.js";class g{constructor(){this.pricelistsBasePath="/Users/alastairblair/Development/Pricelists",this.exportToMasterDatasets=async()=>{try{console.log("Starting master dataset export...");const r=(await h.list({status:"active"})).data;if(!r||r.length===0){console.log("No active items found for export");return}const s=this.groupItemsByBrand(r);await Promise.all(Object.entries(s).map(([a,n])=>this.exportBrandMasterFile(a,n))),await this.createConsolidatedMaster(r),console.log("Master dataset export completed")}catch(o){throw console.error("Error in exportToMasterDatasets:",o),o}},this.groupItemsByBrand=o=>o.reduce((r,s)=>{const a=s.brand||"Unknown";return r[a]||(r[a]=[]),r[a].push(s),r},{}),this.exportBrandMasterFile=async(o,r)=>{try{const s=r.map(t=>({sku:t.sku||"",name:t.name||"",description:t.description||t.name||"",brand_name:o,category:t.category||"",colour:t.colour||"",ean:t.ean||"",manufacturer:t.manufacturer||o,cost_price:t.cost_price||0,retail_price:t.retail_price||t.rate||0,purchase_price:t.purchase_price||t.cost_price||0,weight:t.weight||0,height:t.height||0,width:t.width||0,length:t.length||0,diameter:t.diameter||0,volume:t.volume||0,packing_unit:t.packing_unit||1,gross_stock_level:t.gross_stock_level||t.stock_on_hand||0,reorder_level:t.reorder_level||0,catalogue_page_number:t.catalogue_page_number||"",burning_hours:t.burning_hours||"",scent:t.scent||"",dishwasher:t.dishwasher||"",microwave:t.microwave||"",status:t.status||"active",created_date:t.created_date||t.created_at,updated_at:t.updated_at||new Date().toISOString()})),a=l.json_to_sheet(s),n=l.book_new();l.book_append_sheet(n,a,o);const d=`Master - ${o.replace(/[^a-zA-Z0-9]/g,"")}.xlsx`,u=i(n,{bookType:"xlsx",type:"array"}),p=new Blob([u],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),c=window.URL.createObjectURL(p),e=document.createElement("a");e.href=c,e.download=d,e.click(),window.URL.revokeObjectURL(c),console.log(`Exported ${r.length} items for ${o} to ${d}`),await this.storeExportData(o,s,"brand_master")}catch(s){throw console.error(`Error exporting brand file for ${o}:`,s),s}},this.createConsolidatedMaster=async o=>{try{const r=o.map(e=>({id:e.id||"",sku:e.sku||"",name:e.name||"",description:e.description||e.name||"",brand_name:e.brand||"Unknown",category:e.category||"",colour:e.colour||"",ean:e.ean||"",manufacturer:e.manufacturer||e.brand||"Unknown",packing_unit:e.packing_unit||1,cost_price:e.cost_price||0,retail_price:e.retail_price||e.rate||0,purchase_price:e.purchase_price||e.cost_price||0,weight:e.weight||0,height:e.height||0,width:e.width||0,length:e.length||0,volume:e.volume||0,catalogue_page_number:e.catalogue_page_number||"",burning_hours:e.burning_hours||"",scent:e.scent||"",dishwasher:e.dishwasher||"",microwave:e.microwave||"",image_url:e.image_url||e.image_urls&&e.image_urls[0]||"",status:e.status||"active",created_date:e.created_date||e.created_at,updated_at:e.updated_at||new Date().toISOString()}));console.log(`Creating consolidated master with ${r.length} total items`);const s=l.json_to_sheet(r),a=l.book_new();l.book_append_sheet(a,s,"All Products");const n="Master - Consolidated.xlsx",d=i(a,{bookType:"xlsx",type:"array"}),u=new Blob([d],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),p=window.URL.createObjectURL(u),c=document.createElement("a");c.href=p,c.download=n,c.click(),window.URL.revokeObjectURL(p),console.log(`Exported consolidated master with ${r.length} items`),await this.storeExportData("Consolidated",r,"master_consolidated")}catch(r){throw console.error("Error creating consolidated master:",r),r}},this.generateSystemExports=async()=>{try{console.log("Generating system exports...");const r=(await h.list({status:"active"})).data;if(!r)throw new Error("Failed to fetch items for export");const s={zoho:this.formatForZoho(r),neon:this.formatForNeonProducts(r),bluealligator:this.formatForBlueAlligator(r)};return await Promise.all(Object.entries(s).map(([a,n])=>this.storeExportData(a,n,`export_${a}`))),console.log("System exports completed"),s}catch(o){throw console.error("Error generating system exports:",o),o}},this.formatForZoho=o=>o.map(r=>({"Item Name":r.name||"",SKU:r.sku||"",Description:r.description||"",Category:r.category||"",Brand:r.brand||"",Manufacturer:r.manufacturer||r.brand||"",UPC:r.ean||"",EAN:r.ean||"",ISBN:"","Part Number":r.sku||"","Item Type":"inventory","Product Type":"goods","Stock on hand":r.gross_stock_level||r.stock_on_hand||0,"Opening Stock Rate":r.cost_price||0,"Reorder Level":r.reorder_level||0,"Preferred Vendor":r.brand||"","Purchase Rate":r.purchase_price||r.cost_price||0,"Purchase Account":"Cost of Goods Sold","Purchase Description":r.description||"","Sales Rate":r.retail_price||r.rate||0,"Sales Account":"Sales","Sales Description":r.description||"","Tax Preference":"taxable","Exemption Reason":"","Purchase Tax":"","Sales Tax":"","Item Status":r.status==="active"?"active":"inactive",Source:"user","Is Returnable Item":"true",Weight:r.weight||0,"Weight Unit":"kg","Dimensions (Length x Width x Height)":`${r.length||0} x ${r.width||0} x ${r.height||0}`,"Dimension Unit":"cm","Created Time":r.created_date||r.created_at,"Last Modified Time":r.updated_at})),this.formatForNeonProducts=o=>o.map(r=>({id:r.id,sku:r.sku,name:r.name,description:r.description,brand:r.brand,category:r.category,colour:r.colour,ean:r.ean,manufacturer:r.manufacturer,packing_unit:r.packing_unit,cost_price:r.cost_price,retail_price:r.retail_price||r.rate,purchase_price:r.purchase_price,rate:r.rate,weight:r.weight,height:r.height,width:r.width,length:r.length,volume:r.volume,stock_on_hand:r.stock_on_hand||r.gross_stock_level,reorder_level:r.reorder_level,catalogue_page_number:r.catalogue_page_number,burning_hours:r.burning_hours,scent:r.scent,dishwasher:r.dishwasher,microwave:r.microwave,image_urls:r.image_urls,status:r.status,created_at:r.created_at||r.created_date,updated_at:r.updated_at})),this.formatForBlueAlligator=o=>o.map(r=>({"Product Code":r.sku||"","Product Name":r.name||"",Description:r.description||"",Brand:r.brand||"",Category:r.category||"",Colour:r.colour||"",Barcode:r.ean||"",Supplier:r.manufacturer||r.brand||"","Pack Size":r.packing_unit||1,"Cost Price":r.cost_price||0,"Retail Price":r.retail_price||r.rate||0,"Weight (kg)":r.weight||0,"Dimensions (cm)":`${r.length||0}x${r.width||0}x${r.height||0}`,"Stock Level":r.gross_stock_level||r.stock_on_hand||0,"Reorder Level":r.reorder_level||0,Status:r.status||"active","Date Added":r.created_date||r.created_at,"Last Updated":r.updated_at})),this.storeExportData=async(o,r,s)=>{try{const a={system:o,type:s,record_count:r.length,generated_at:new Date().toISOString(),status:"ready"};console.log(`Export stored for ${o}:`,a);const n=JSON.parse(localStorage.getItem("export_logs")||"[]");n.push(a),n.length>100&&n.splice(0,n.length-100),localStorage.setItem("export_logs",JSON.stringify(n))}catch(a){console.error(`Error storing export data for ${o}:`,a)}},this.triggerLegacyExports=async()=>{try{console.log("Triggering legacy export processes..."),console.log("Would execute: python3 /Users/alastairblair/Development/Pricelists/auto_process.py")}catch(o){console.error("Error triggering legacy exports:",o)}},this.runFullExportWorkflow=async()=>{try{console.log("Starting full export workflow..."),await this.exportToMasterDatasets(),await this.generateSystemExports(),await this.triggerLegacyExports(),console.log("Full export workflow completed successfully")}catch(o){throw console.error("Error in full export workflow:",o),o}}}}const x=new g;export{x as pricelistExportService};
//# sourceMappingURL=pricelistExportService-CZyW_cRP.js.map
